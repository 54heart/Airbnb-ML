---
title: "EDA"
output: html_document
---
## New Variables:
1. host_exp_years: years since becoming a host

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown
```{r load}
library(readr)
library(dplyr)
setwd("~/Google Drive/MSBA/ClarkR/Project/Data")
train_x <- read_csv("airbnb_train_x.csv")
train_y <- read_csv("airbnb_train_y.csv")
test_x <- read_csv("airbnb_test_x.csv")
my_train_x<- train_x[, 29:42]
```

## see all the variables

```{r pressure, echo=FALSE}
train_x %>% colnames() 
```

```{r}
train.cor <- cor(as.matrix(train_x[, c(3, 5, 6)]))
train.cor
```

```{r}
library(funModeling) 
library(tidyverse) 
library(Hmisc)
status(my_train_x)
```

```{r}
glimpse(my_train_x)
```

## host_listings_count
how many listings the host has right now
```{r host_listings_count, echo=FALSE}
my_train_x[, 1] %>% summary()

boxplot(my_train_x[, 1])


```

```{r}
host_listings_count_freq<- as.data.frame(table(unlist(my_train_x[, 1])))
plot(host_listings_count_freq$Var1, host_listings_count_freq$Freq)
# skewed to left, median is 1, has 151 NAs
```

## host_location
```{r host_location}
my_train_x[[2]]

```

## host_name 
```{r host_location, echo=FALSE}
m3 <- as.data.frame(my_train_x[, 3])

#number of na is 147
is.na(m3) %>% table()

temp<- filter(m3, is.na(m3)==FALSE)

#convert all elements to lowercase
for (i in 1: nrow(temp[1])){
  temp[i, 1] <- tolower(temp[i, 1])
}

temp$couple <- as.integer(grepl(pattern = " and |\\+|\\&", x = temp$host_name))
sum(temp$couple)
# 7148 couple hosts
```

##  host_neighbourhood 
```{r host_location, echo=FALSE}
m4<- my_train_x[, 4]
describe(m4)

# a lot of missing values


```

## host_response_rate
```{r host_location, echo=FALSE}
library(frequency)
m5 <- my_train_x[, 5]



# coerce wrong inputs such as "house", "Apartment" as NA
m5 <- as.character(unlist(m5))
m5 <- (as.numeric(sub("%", "", m5))/100) #remove percent sign


freq(m5)
#very skewed, most hosts respond quickly
```


## host_response_time 
```{r host_location, echo=FALSE}
freq(my_train_x[, 6])

# One-hot encoded
m6 <- my_train_x[, 6]%>%mutate( 
  		# Create 
  		an_hr = ifelse(host_response_time  == "within an hour", 1, 0),
  		few_hr = ifelse(host_response_time  == "within a few hours", 1, 0),
  		a_day = ifelse(host_response_time  == "within a day", 1, 0),
  		few_days = ifelse(host_response_time  == "within a few days", 1, 0))

# plot review rating against response time
x<-as.data.frame(train_x[34])
y<- as.data.frame(train_y[2])
df<- cbind(x,y)
ggplot(data = df, aes(x = df$host_response_time, y = df$review_scores_rating))+geom_boxplot()
# don't know what f means
```

## host_since
```{r host_location, echo=FALSE}
m7 <- my_train_x[, 7]
m7 <- as.Date(m7$host_since)

x<-as.data.frame(train_x[35])
y<- as.data.frame(train_y[2])

df<- cbind(x,y)
ggplot(data = df, aes(x = df$host_since, y = df$review_scores_rating))+
  geom_line(color = "#00AFBB", size = 0.4)


# Create new variable of years since first becoming a host
today <- as.Date("2020-04-04")
host_exp_years<- difftime(today, m7)/365

```

## host_total_listings_count: how many listings hosted ever
```{r host_location, echo=FALSE}
m8 <- my_train_x$host_total_listings_count

m8_freq<- as.data.frame(table(m8))
plot(m8_freq$m8, m8_freq$Freq)
```

## host_verifications
```{r , echo=FALSE}
m9 <- my_train_x$host_verifications

# remove symbols and split
m9 <- gsub("\\[|]", "", m9)
m9 <- gsub('"', '', m9)
m9 <- gsub("'", "", m9)
m9 <-strsplit(m9,", ")

# unique values of verifications
uni <- unique(unlist(m9)) 

# What percentage of hosts has a kind of verification
veri_percent <- c()
for (i in uni){
  percent <- mean(grepl(i, m9))
  veri_percent <- c(veri_percent, percent)
}

#email, phone, reviews are popular verifications 
```

## house_rules
```{r host_location, echo=FALSE}
m10<-(my_train_x$house_rules)


library(tidytext)
m10 %>%
  unnest_tokens(word, m10) %>%
  anti_join(stop_words) %>%
  count(word, sort = TRUE)

```

## instant_bookable
Interestingly, if the listing is instant bookable, it is more likely to have a high_booking_rate. However, an instant bookable listing tends to have a lower review scores than a non-instant_bookable listing.
```{r host_location, echo=FALSE}
m11 <- my_train_x[[11]]

# convert datatype to 1, 0
m11 <- ifelse(m11 ==TRUE, 1, 0)

instant_bookable <- as.factor(my_train_x[[11]])
popular <- as.factor(train_y$high_booking_rate)
rating_score <- train_y$review_scores_rating

df <- data.frame(instant_bookable, popular, rating_score)

ggplot(df, aes(instant_bookable, ..count..)) + geom_bar(aes(fill = popular), position = "dodge")
ggplot(df, aes(instant_bookable, rating_score)) + geom_boxplot()
```

## interaction
```{r host_location, echo=FALSE}
my_train_x$interaction
```

## is_business_travel_ready
```{r host_location, echo=FALSE}
m13 <- my_train_x$is_business_travel_ready

# convert datatype to 1, 0
m13 <- ifelse(m13 ==TRUE, 1, 0)
```

## is_location_exact
```{r host_location, echo=FALSE}
m14 <- my_train_x$is_location_exact

# convert datatype to 1, 0
m14 <- ifelse(m14 ==TRUE, 1, 0)


```
